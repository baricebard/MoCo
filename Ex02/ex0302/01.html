<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>DeviceMotion Demo</title>
<style>
  body { font-family: sans-serif; padding: 20px; line-height: 1.6; }
  button { padding: 10px 20px; font-size: 16px; }
  pre { background: #f3f3f3; padding: 10px; border-radius: 6px; }
</style>
</head>
<body>

<h2>DeviceMotion 測試頁面</h2>
<p>請點擊下方按鈕授權存取行動裝置感測器。</p>

<button id="btn">啟用 DeviceMotion</button>

<h3>感測器資料：</h3>
<pre id="output">尚未啟用</pre>

<script>
async function requestPermissionIfNeeded() {
  // 非 iOS：不需要任何授權流程
  if (typeof DeviceMotionEvent.requestPermission !== "function") {
    return "granted";
  }

  // iOS：必須在使用者操作後呼叫
  try {
    const state = await DeviceMotionEvent.requestPermission();
    return state; // "granted" 或 "denied"
  } catch (err) {
    return "denied";
  }
}

document.getElementById("btn").addEventListener("click", async () => {
  const result = await requestPermissionIfNeeded();

  if (result !== "granted") {
    document.getElementById("output").textContent = "使用者拒絕授權或未允許感測器存取。";
    return;
  }

  document.getElementById("output").textContent = "等待 DeviceMotion 資料…";

  window.addEventListener("devicemotion", event => {
    const acc = event.acceleration;
    const accG = event.accelerationIncludingGravity;
    const rot = event.rotationRate;

    document.getElementById("output").textContent =
      `加速度（不含重力）:
  x: ${acc?.x?.toFixed(3)}  
  y: ${acc?.y?.toFixed(3)}
  z: ${acc?.z?.toFixed(3)}

加速度（含重力）:
  x: ${accG?.x?.toFixed(3)}
  y: ${accG?.y?.toFixed(3)}
  z: ${accG?.z?.toFixed(3)}

旋轉速度:
  alpha(Z): ${rot?.alpha?.toFixed(3)}
  beta(X):  ${rot?.beta?.toFixed(3)}
  gamma(Y): ${rot?.gamma?.toFixed(3)}

更新頻率: ${event.interval} ms
`;
  });
});
</script>

</body>
</html>
