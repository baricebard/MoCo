# 運算子及運算元  

運算子指的是如 `+`、`-`、`*`、`/` 等符號，還有其他的運算子。  

## 專有名詞：運算子 operator、運算元 operand  

當你想計算 5 + 3 的結果時，你會輸入  

``` JavaScript
  5 + 3 // 運算元 5、3 ，運算子 +
```  

左邊的運算元是 `5`， 右邊的運算元是 `3`，將 `5` 和 `3` 相加的運算子是 `+`  
計算結果應該是 `8`  

## 一元運算子 Unary、二元運算子 Binary、三元運算子 Ternary  

當運算子有幾個運算元時，叫做幾元運算子。一元、二元、三元。  

例：`-`可以當做 1. 負號 2.減法  

```JavaScript
  let x = 1;

  x = -x;
  alert( x ); // -1, 負號 一元運算子

  let y = 3;
  alert( y - x ); // 2, 減法 二元運算子
```

## 算數運算  

- 加法 `+`
- 減法 `-`
- 乘法 `*`
- 除法 `/`
- 餘數 `%`
- 指數運算(冪運算) `**`  

### `%` 取餘數  

當 `a % b` 時，結果會是 `a` 整除 `b` 的餘數  

``` JavaScript
  alert( 5 % 2 ); // 1, 5 整除 2 餘 1
  alert( 8 % 3 ); // 2, 8 整除 3 餘 2
  alert( 8 % 4 ); // 0, 8 整除 4 餘 0
```

### `**` 指數運算  

當 `a ** b` 時，結果會是 `a` 的 `b` 次方，常見記為 $a^b$  

```JavaScript
  alert( 2 ** 2 ); // 2 的 2 次方，結果 4
  alert( 2 ** 3 ); // 2 的 3 次方，結果 8
  alert( 2 ** 4 ); // 2 的 4 次方，結果16
```  

指數運算子也可以是非整數  

```JavaScript
  alert( 4 ** (1/2) ); // 4 開根號，結果 2
  alert( 8 ** (1/3) ); // 8 開立方根，結果 3
```  

## 用 `+` 來拼接字串  

拼接兩個字串用 `+`  

``` JavaScript
  let s = "Welcome " + "JavaScript.";
  alert(s); // Welcome JavaScript.
```  

如果任何一個操作數是字串，那麼另一個操作數也會轉換為字串  
第一個運算元是字串還是第二個運算元是字串並不重要  

```JavaScript
  alert( '1' + 2 ); // "12"
  alert( 2 + '1' ); // "21"
```  

更複雜的例子  

```JavaScript
  alert(2 + 2 + '1' ); // "41" 而不是 "221"
```  

先算 `2+2`，結果是 `4` ，再算 `4+'1'` ，結果是 `'41'`  
另一個複雜的例子  

```JavaScript
  alert('1' + 2 + 2); // "122" 而不是 "14"
```

計算過程你知道嗎？  

只有 `+` 會把運算元轉成數字，其他算數符號會把運算元轉成數值  

```JavaScript
  alert( 6 - '2' ); // 把字元 `2` 轉換成數字 2，進行 6 - 2 運算，結果是 4 
  alert( '6' / '2' ); // 把字元 `6` 和 `2` 轉換成數字 6 和 2 進行 6 / 2 運算，結果是 3
```  

## 數值轉換 一元 `+`  

一元的 `+` 會把非數值，轉換成數值  

```JavaScript
  // 一元 `+` 沒有進行轉換或效用的例子
  let x = 1;
  alert( +x ); // 1

  let y = -2;
  alert( +y ); // -2

  // 把非數值轉換成數值
  alert( +true ); // 1
  alert( +"" );   // 0
```  

這個 `+` 和 Number(...) 函數的轉換效果一樣  

我們常常會從 HTML 取得用戶的輸入  
從 HTML 取得的都是字串型態  

```JavaScript
  let apples = "2";
  let oranges = "3";

  alert( apples + oranges ); // "23", 結果是字串拼接
```  

若要進行求和  

```JavaScript
  let apples = "2";
  let oranges = "3";

  // 把兩個值各別先用 `+` 轉換成數值，再進行相加
  alert( +apples + +oranges ); // 5

  // 使用 Number 的方法
  // alert( Number(apples) + Number(oranges) ); // 5
``` 

## 運算子的優先級  

同時出現時，基本上符合先乘除後加減  
但其實有更詳細的執行優先級  

優先級查表(簡易版)  

| 優先權 | 名稱 | 符號 |
|:--|:--|:--|
| … | … | … |
| 14 | 一元正號 | + |
| 14 | 一元負號 | - |
| 13 | 指數運算 | ** |
| 12 | 乘法 | * |
| 12 | 分配 | / |
| 11 | 二元加法 | + |
| 11 | 二元減法 | - |
| … | … | … |
| 2 | 賦值 | = |
| … | … | … |

完整表  
[MDN 運算子優先序](https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Operators/Operator_precedence)  

所以回到上一個例子，一元運算子 `+` 會先把 `apple`、`oranges` 轉成數值，再進行二元運算子的 `+` 加法運算  
括號 `()` 會打破任何優先級，括號內的運算會先執行  

```JavaScript
  alert( 2 * 2 + 1 ); // 5
  alert( 2 * (2 + 1) ); // 6
```

## `=` 賦值運算

賦值 `=` 也是一個運算子。  
它在優先級為 2 ，優先級很低。  
所以，當我們分配一個變數 `x` 時，例如 `x = 2 * 2 + 1`，會先進行計算，然後才執行 `=`， 將結果儲存在 `x` 中  

```JavaScript
  let x = 2 * 2 + 1;

  alert( x ); // 5
```   

### `=` 會賦值也會回傳  
所有運算子都會回傳數值，當然包括 `=`  
當執行 `x = value` 時，會把 `value` 寫入 `x` 然後回傳  

```JavaScript
  let a = 1;
  let b = 2;

  let c = 3 - (a = b + 1);

  alert( a ); // 3
  alert( c ); // 0
```  

雖然你知道會這樣，寫程式的時候要避免這樣寫  

## 連續賦值  

賦值也可以這樣做  

```JavaScript  
  let a, b, c;

  a = b = c = 2 + 2;

  alert( a ); // 4
  alert( b ); // 4
  alert( c ); // 4
```  

因優先級，先執行 `2+2` ，然後再進行 `=` 賦值，所以最後 `a`、`b`、`c` 全部是 4  

但是，這種寫法不好，最好還是分開寫，以後會比較容易閱讀   

```JavaScript
  c = 2 + 2;
  b = c;
  a = c;
```  

## 複合設定  
有一個常發生的場景，先 `x` 取得數值然後運算，再存回 `x`  

例如：  

```JavaScript
let n = 2;
n = n + 5; // 7
n = n * 2; // 14
```  
可以用複合運算子來簡化寫法  
``` JavaScript
let n = 2;
n += 5; // 現在 n = 7 (同 n = n + 5)
n *= 2; // 現在 n = 14 (同 n = n * 2)

alert( n ); // 14
``` 
所有的算數運算子都對應一個複合運算子 `+=`、`-=`、`*=`、`/=` 優先級和 `=` 相同  
``` JavaScript
let n = 2;

n *= 3 + 5; // 先執行 3 + 5, 然後再賦值 n *= 8

alert( n ); // 16
```  

## 遞增、遞減  
將數字增加或減少一是最常見的數字運算之一  
遞增 `++` 將變數增加 1 
``` JavaScript
let counter = 2;
counter++;        // 相同於 counter = counter + 1 
alert( counter ); // 3
``` 

遞減 `--` 將變數增加 1 
``` JavaScript
let counter = 2;
counter--;        // 相同於 counter = counter - 1 
alert( counter ); // 1
``` 

`++`、`--`只能用於變數，用於數值就會出錯，例如 `5++`   

運算子 `++` 和 `--` 可以放在變數之前或之後
- 當運算子位於變數之後稱為「後綴形式」：counter++  
- 當運算子位於變數之前稱為「前綴形式」：++counter  

有什麼不同？  
``` JavaScript
// 前綴
let counter = 1;
let a = ++counter; // 

alert(a); // 2
``` 

``` JavaScript
// 後綴
let counter = 1;
let a = counter++; // 

alert(a); // 1
``` 

遞增、遞減立即使用，才有差別  
``` JavaScript
let counter = 0;
counter++;
++counter;
alert( counter ); 
``` 

如果我們想要增加一個值並立即使用運算符的結果，使用前綴：    
``` JavaScript
let counter = 0;
alert( ++counter ); // 1
``` 

如果我們想增加一個值但使用其先前的值，使用後綴：    
``` JavaScript
let counter = 0;
alert( counter++ ); // 0
``` 

這樣也可以，但應少用
``` JavaScript
let counter = 1;
alert( 2 * ++counter ); // 4
```
``` JavaScript
let counter = 1;
alert( 2 * counter++ ); // 2
```  
應該分開寫  
``` JavaScript
let counter = 1;
alert( 2 * counter );
counter++;
```  

## 位元運算子  
位元運算子將參數視為 32 位元整數，對其二進位進行操作  
- AND （&）
- OR （|）
- XOR（^）
- NOT （~）
- LEFT SHIFT  (<<)
- RIGHT SHIFT (>>)
- ZERO-FILL RIGHT SHIFT (>>>)  

## 逗號 Comma  
進行多次運算，輸出最後一次結果  
``` JavaScript
let a = (1 + 2, 3 + 4);

alert( a ); // 7 ，3 + 4 的結果
``` 
為什麼要用這種東西？  框架中會使用，為了縮小檔案大小  
``` JavaScript
for (a = 1, b = 3, c = a * b; a < 10; a++) {
 ...
}
``` 
## 任務
下面的程式碼之後所有變數a、b和c的最終值是多少？  
``` JavaScript
let a = 1, b = 1;

let c = ++a; // ?
let d = b++; // ?
```
<detail>
<summary>參考答案</summary>
`a=2`
`b=2`
`c=2`
`d=2`
```javascript
let a = 1, b = 1;

alert( ++a ); // 2, 前綴
alert( b++ ); // 1, 後綴

alert( a ); // 2, 
alert( b ); // 2, 
```
</detail>

## 任務
下面程式碼後面的 `a` 和 `x` 的值分別是什麼？ 
``` JavaScript
let a = 2;

let x = 1 + (a *= 2);
```
<detail>
<summary>參考答案</summary>

a = 4（乘以2）
x = 5（計算方式為 1 + 4

</detail>

## 任務  
這些表達式的結果是什麼？ 
``` JavaScript
"" + 1 + 0
"" - 1 + 0
true + false
6 / "3"
"2" * "3"
4 + 5 + "px"
"$" + 4 + 5
"4" - 2
"4px" - 2
"  -9  " + 5
"  -9  " - 5
null + 1
undefined + 1
" \t \n" - 2
```
<detail>
<summary>參考答案</summary>
```javascript
"" + 1 + 0 = "10" // (1)
"" - 1 + 0 = -1 // (2)
true + false = 1
6 / "3" = 2
"2" * "3" = 6
4 + 5 + "px" = "9px"
"$" + 4 + 5 = "$45"
"4" - 2 = 2
"4px" - 2 = NaN
"  -9  " + 5 = "  -9  5" // (3)
"  -9  " - 5 = -14 // (4)
null + 1 = 1 // (5)
undefined + 1 = NaN // (6)
" \t \n" - 2 = -2 // (7)
```
1. 與字串的加法 `"" + 1`，轉換 `1` 為字串，所以 `"" + 1 = "1"`，然後我們有 `"1" + 0`，套用相同的規則將 `0` 轉換為 '0'
2. 減法-（像大多數數學運算一樣）僅適用於數字，它將空字串轉換 "" 為 `0` 
3. 字串加法是將數字 5 附加到字串
4. 減法總是轉換為數字，因此它會將 " -9 " 轉換成一個數字 `-9`（忽略周圍的空格）
5. `null` 經過轉換後變成數值 `0`
6. `undefined` 經過轉換後變成特殊數值 `NaN`
7. 將字串轉換為數字時，字串開頭和結尾的空格會被清除。此時，整個字串由空格字元（例如\t 和 \n 以及它們之間的空格組成。因此，與空字串類似變成了 `0`
</detail>  
